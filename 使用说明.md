# AI Toolkit 使用指南

本文档提供了 AI Toolkit 的基本使用说明，包括如何启动项目、更新依赖以及常见操作指南。

## 目录

1. [启动项目](#启动项目)
2. [更新项目](#更新项目)
3. [数据库管理](#数据库管理)
4. [常见问题](#常见问题)

## 启动项目

### 首次启动

如果是首次启动项目，请按照以下步骤操作：

1. 进入 UI 目录：
   ```bash
   cd /workspace/ai-toolkit/ui
   ```

2. 安装依赖：
   ```bash
   npm install
   ```

3. 更新数据库：
   ```bash
   npm run update_db
   ```

4. 构建应用：
   ```bash
   npm run build
   ```

5. 启动应用：
   ```bash
   npm run start
   ```

应用将在以下地址可访问：
- 本地访问：http://localhost:8675
- 网络访问：http://[服务器IP]:8675

### 日常启动

如果已经完成了首次启动的设置，后续只需执行：

```bash
cd /workspace/ai-toolkit/ui
npm run start
```

### 开发模式启动

如果需要在开发模式下启动（支持热重载）：

```bash
cd /workspace/ai-toolkit/ui
npm run dev
```

### 后台运行

如果需要在后台持续运行应用：

```bash
cd /workspace/ai-toolkit/ui
nohup npm run start &
```

或使用 screen/tmux：

```bash
screen -S ai-toolkit
cd /workspace/ai-toolkit/ui
npm run start
# 按 Ctrl+A 然后按 D 分离 screen 会话
```

重新连接 screen 会话：
```bash
screen -r ai-toolkit
```

## 更新项目

### 更新依赖

定期更新依赖可以修复安全漏洞并获取新功能：

```bash
cd /workspace/ai-toolkit/ui
npm update
```

### 更新 Prisma

更新 Prisma 到最新版本：

```bash
cd /workspace/ai-toolkit/ui
npm i --save-dev prisma@latest
npm i @prisma/client@latest
npx prisma generate
```

### 修复安全漏洞

检查并修复安全漏洞：

```bash
cd /workspace/ai-toolkit/ui
npm audit
npm audit fix        # 修复不需要特别注意的问题
npm audit fix --force  # 修复所有问题（可能会更改依赖版本）
```

### 重新构建

在更新依赖后重新构建应用：

```bash
cd /workspace/ai-toolkit/ui
npm run build
```

## 数据库管理

### 查看数据库结构

```bash
cd /workspace/ai-toolkit/ui
npx prisma studio
```

这将打开一个浏览器窗口，显示数据库结构和内容。

### 重置数据库

⚠️ 警告：此操作将删除所有数据！

```bash
cd /workspace/ai-toolkit/ui
npx prisma migrate reset
```

### 备份数据库

```bash
cp /workspace/aitk_db.db /workspace/aitk_db_backup_$(date +%Y%m%d).db
```

## 常见问题

### 应用无法启动

检查以下几点：
- 确保所有依赖已正确安装：`npm install`
- 确保数据库已更新：`npm run update_db`
- 检查日志文件获取详细错误信息

### 数据库错误

如果遇到数据库相关错误：
- 尝试重新生成 Prisma 客户端：`npx prisma generate`
- 检查数据库连接配置
- 如果问题持续，可能需要重置数据库（会丢失数据）

### 端口冲突

如果端口 8675 已被占用，可以修改启动命令指定不同端口：

```bash
cd /workspace/ai-toolkit/ui
npm run start -- --port 8676
```

### 内存不足

如果遇到内存不足的错误，可以增加 Node.js 的内存限制：

```bash
cd /workspace/ai-toolkit/ui
NODE_OPTIONS="--max-old-space-size=4096" npm run start
```

---

如有其他问题，请参考项目文档或联系技术支持团队。